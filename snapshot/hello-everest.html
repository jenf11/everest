
<!DOCTYPE html>
<!--
 Generated by Apache Maven Doxia at 2014-01-31
 Rendered using Maven Reflow Skin 1.0.0 (http://andriusvelykis.github.com/reflow-maven-skin)
-->
<html  xml:lang="en" lang="en">

	<head>
		<meta charset="UTF-8" />
		<title>Hello Everest! | everest</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta name="description" content="" />
		<meta http-equiv="content-language" content="en" />

		<link href="./css/bootstrap.min.css" rel="stylesheet" />
		<link href="./css/bootstrap-responsive.min.css" rel="stylesheet" />
		<link href="./css/docs.css" rel="stylesheet" />
		<link href="./css/reflow-skin.css" rel="stylesheet" />
		
		<link href="http://yandex.st/highlightjs/7.3/styles/github.min.css" rel="stylesheet" />
		
		<link href="./css/lightbox.css" rel="stylesheet" />
		
		<link href="./css/site.css" rel="stylesheet" />
		<link href="./css/print.css" rel="stylesheet" media="print" />
		
		<!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
		<!--[if lt IE 9]>
			<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
		<![endif]-->
		
<link rel="stylesheet" href="css/font-awesome.css"/>
<link rel="stylesheet" type="text/css" media="screen" href="css/orange.css"/>
<link rel="stylesheet" type="text/css" media="screen" href="css/style.css"/>
	</head>

	<body class="page-hello-everest project-everest" data-spy="scroll" data-offset="60" data-target="#toc-scroll-target">

		<div class="navbar navbar-fixed-top navbar-inverse">
			<div class="navbar-inner">
				<div class="container">
					<a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
					</a>
					<a class="brand" href="index.html"><span class="color-highlight">OW2 Chameleon</span> ~ Everest</a>
					<div class="nav-collapse">
						<ul class="nav pull-right">
							<li><a href="downloads.html" title="Download">Download </a></li>
							<li><a href="http://github.com/ow2-chameleon/everest" title="GitHub project" class="externalLink">GitHub project </a></li>
							<li class="dropdown active">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">Documentation <b class="caret"></b></a>
								<ul class="dropdown-menu">
									<li class="dropdown-submenu">
										<a href="about.html" title="everest">everest </a>
										<ul class="dropdown-menu">
											<li><a href="about.html" title="About">About </a></li>
											<li><a href="downloads.html" title="Downloads">Downloads </a></li>
											<li><a href="documentation.html" title="Documentation">Documentation </a></li>
											<li class="active"><a href="" title="Hello Everest!">Hello Everest! </a></li>
										</ul>
									</li>
									<li class="dropdown-submenu">
										<a href="everest-core/index.html" title="everest-core">everest-core </a>
										<ul class="dropdown-menu">
											<li><a href="everest-core/index.html" title="Home">Home </a></li>
											<li><a href="everest-core/getting-started.html" title="Getting Started">Getting Started </a></li>
											<li><a href="everest-core/concepts.html" title="Concepts">Concepts </a></li>
										</ul>
									</li>
									<li class="dropdown-submenu">
										<a href="everest-osgi/index.html" title="everest-OSGi">everest-OSGi </a>
										<ul class="dropdown-menu">
											<li><a href="everest-osgi/index.html" title="Home">Home </a></li>
											<li><a href="everest-osgi/index.html#tutorials" title="Tutorials">Tutorials </a></li>
											<li><a href="everest-osgi/index.html#osgi-root-resource" title="Root">Root </a></li>
											<li><a href="everest-osgi/index.html#bundle" title="Bundles">Bundles </a></li>
											<li><a href="everest-osgi/index.html#package" title="Packages">Packages </a></li>
											<li><a href="everest-osgi/index.html#service" title="Services">Services </a></li>
											<li><a href="everest-osgi/index.html#configuration" title="Configurations">Configurations </a></li>
											<li><a href="everest-osgi/index.html#log-entry" title="Logs">Logs </a></li>
											<li><a href="everest-osgi/index.html#deployment-package" title="Deployment Packages">Deployment Packages </a></li>
										</ul>
									</li>
									<li class="dropdown-submenu">
										<a href="everest-ipojo/index.html" title="everest-iPOJO">everest-iPOJO </a>
										<ul class="dropdown-menu">
											<li><a href="everest-ipojo/index.html" title="Home">Home </a></li>
											<li><a href="everest-ipojo/ReferenceCard.html" title="Reference Card">Reference Card </a></li>
											<li><a href="everest-ipojo/Root.html" title="Root">Root </a></li>
											<li><a href="everest-ipojo/Instances.html" title="Instances">Instances </a></li>
											<li><a href="everest-ipojo/ServiceDependencies.html" title="Instance service dependencies">Instance service dependencies </a></li>
											<li><a href="everest-ipojo/ServiceProvidings.html" title="Instance service providings">Instance service providings </a></li>
											<li><a href="everest-ipojo/Factories.html" title="Factories">Factories </a></li>
											<li><a href="everest-ipojo/Handlers.html" title="Handlers">Handlers </a></li>
											<li><a href="everest-ipojo/InstanceDeclarations.html" title="Instance declarations">Instance declarations </a></li>
											<li><a href="everest-ipojo/TypeDeclarations.html" title="Type declarations">Type declarations </a></li>
											<li><a href="everest-ipojo/ExtensionDeclarations.html" title="Extension declarations">Extension declarations </a></li>
										</ul>
									</li>
									<li class="dropdown-submenu">
										<a href="everest-servlet/index.html" title="everest-servlet">everest-servlet </a>
										<ul class="dropdown-menu">
											<li><a href="everest-servlet/index.html" title="Home">Home </a></li>
										</ul>
									</li>
									<li class="dropdown-submenu">
										<a href="everest-system/index.html" title="everest-System">everest-System </a>
										<ul class="dropdown-menu">
											<li><a href="everest-system/index.html" title="Home">Home </a></li>
										</ul>
									</li>
								</ul>
							</li>
							<li class="dropdown">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">Contribute <b class="caret"></b></a>
								<ul class="dropdown-menu">
									<li><a href="contribution.html" title="Contribute">Contribute </a></li>
									<li><a href="source-repository.html" title="Sources">Sources </a></li>
									<li><a href="http://github.com/ow2-chameleon/everest/issues/" title="Issues" class="externalLink">Issues </a></li>
									<li><a href="http://github.com/ow2-chameleon/everest" title="Fork on GitHub" class="externalLink">Fork on GitHub </a></li>
								</ul>
							</li>
						</ul>
					</div><!--/.nav-collapse -->
				</div>
			</div>
		</div>
		
	<div class="container">
	
	<!-- Masthead
	================================================== -->
	</header>

	<div class="main-body">
	<div class="row">
		<div class="span8">
			<div class="body-content">
<div class="page-header">
 <h1 id="hello_everest">Hello Everest!</h1>
</div> 
<p>Here goes the Everest, Aconcagua and other Seven Summits.</p> 
<h2 id="requirement">Requirement</h2> 
<p>In order to follow the tutorial, you need to download :</p> 
<ul> 
 <li>This OSGi framework ( based on Chameleon ). You can download and build the test distribution from everest-distrib.</li> 
 <li>A ReST plug-in for your browser to interact with your domain( google chrome : <a href="https://chrome.google.com/webstore/detail/advanced-rest-client/hgmloofddffdnphfgcellkdfbfbjeloo" title="Advanced Rest Client">Advanced ReST Client</a>, mozilla : <a href="https://addons.mozilla.org/fr/firefox/addon/restclient/" title="restClient">restClient</a>).</li> 
</ul> 
<p>Additionally, you need to have read the part about <strong><a href="everest-core/concepts.html">concept</a></strong> and <strong><a href="everest-core/getting-started.html">getting started</a></strong>.</p> 
<p><strong>NB</strong> : In order to launch the everest-distrib, do :</p> 
<ul> 
 <li>Linux : launch the chameleon script ( <em>command</em> : <code>./chameleon.sh --interactive</code>)</li> 
 <li>Windows : use the following <em>command</em> : <code>java -jar .\bin\chameleon-core-1.0.0-SNAPSHOT.jar --interactive</code></li> 
</ul> 
<h2 id="general_purpose_about_domain">General purpose about domain</h2> 
<h3 id="what_is_a_domain_">What is a domain ?</h3> 
<p>A domain is a set of resources representing a particular context. The level of granularity of resources is defined by the designer of the domain.</p> 
<h3 id="first_step__identify_your_resources">First step : identify your resources</h3> 
<p>In this tutorial, the domain we will represent is the house. So the first and primordial step is to identify the several resources of the domain.</p> 
<p>For this example we choose to represent the house like this : <img src="everest-casa.png" alt="&amp;ldquo;Representation of the house&amp;rdquo;" /></p> 
<ul> 
 <li><strong>Device</strong> : represents all the electronic equipment in the house (binarylight, sensors, cooler…), each device is defined by a serial number.</li> 
 <li><strong>Person</strong> : represents the inhabitant of the house.</li> 
 <li><strong>Zone</strong> : represents the different parts of the house(kitchen, bathroom…).</li> 
</ul> 
<p>The granularity of the resources is defined by the designer of the domain. Indeed, we can detail the device resource in sub-resource as:</p> 
<ul> 
 <li><strong>Light</strong> : every equipment in relation with luminosity (binaryLight, photometer…).</li> 
 <li><strong>Heat</strong> : every equipment in relation with temperature (heater, thermometer…).</li> 
 <li><strong>Music</strong> : every equipment in relation with sound (speaker, audio source…).</li> 
</ul> 
<h3 id="everest_in_all_this">Everest in all this</h3> 
<p>Everest is a resources manager which allowed to translate the precedent representation in a ReST way. In our case the ReST layout is :</p> 
<ul> 
 <li><strong>/casa</strong> - The root of the everest Casa domain. 
  <ul> 
   <li><strong>/devices</strong> 
    <ul> 
     <li><strong>$serialNumber</strong> - The device identified by <em>$serialNumber</em>.</li> 
    </ul></li> 
   <li><strong>/person</strong></li> 
   <li><strong>/zone</strong> 
    <ul> 
     <li><strong>/$nameZone</strong> - The zone named <em>$nameZone</em>.</li> 
    </ul></li> 
  </ul></li> 
</ul> 
<h2 id="build_your_domain">Build your domain</h2> 
<h3 id="the_root_resource">The root resource</h3> 
<p>The starting point of each domain is the root resource. It contains all the sub resource of the domain. In our case the root resource is Casa. So let’s implement your first resource !</p> 
<pre><code class="java">public class CasaRootResource extends DefaultReadOnlyResource {

    /**
     * Name of the resource
     */
    public static final String m_casaRoot = &quot;casa&quot;;

    /**
     * Path of the resource : /casa
     */
    public static final Path m_casaRootPath = Path.from(Path.SEPARATOR + m_casaRoot);

    /**
     * Description of the resource
     */
    private static final String m_casaDescription = &quot;casa resources&quot;;

    /**
     * List of the subResource : Contains the direct sub resource of root
     */
    private final List&lt;Resource&gt; m_casaResources = new ArrayList&lt;Resource&gt;();

    /**
     * Constructor of Casa
     */
    public CasaRootResource() {
        super(m_casaRootPath);
    }

    /**
     * Extract the sub resource of casa
     */
    @Override
    public List&lt;Resource&gt; getResources() {
        return m_casaResources;
    }
}
</code></pre> 
<p>In order to create the resource hierarchy,we create 3 class PersonManager, GenericDeviceManager and ZoneManager.</p> 
<ul> 
 <li>The code of GenericDeviceManager :</li> 
</ul> 
<pre><code class="java">public class GenericDeviceManager extends DefaultReadOnlyResource {

    /**
     * Name of the resource manager
     */
    public static final String m_genericDeviceName = &quot;devices&quot;;

    /**
     * Path of the resource manager, here /casa/devices
     */
    public static final Path m_genericDevicePath = m_casaRootPath.add(Path.from(Path.SEPARATOR + m_genericDeviceName));

    /**
     * Static instance of this singleton class
     */
    private static final GenericDeviceManager m_instance = new GenericDeviceManager();

    /**
     * Getter of the static instance of this singleton class
     *
     * @return the singleton static instance
     */
    public static GenericDeviceManager getInstance() {
        return m_instance;
    }

    public GenericDeviceManager() {
        super(m_genericDevicePath);
    }

}
</code></pre> 
<ul> 
 <li>The code of ZoneManager :</li> 
</ul> 
<pre><code class="java">public class ZoneManager extends DefaultReadOnlyResource {

    public static final String m_zoneName = &quot;zone&quot;;

    public static final Path m_zonePath = m_casaRootPath.add(Path.from(Path.SEPARATOR + m_zoneName));

    /**
     * Static instance of this singleton class
     */
    private static final ZoneManager m_instance = new ZoneManager();

    public static ZoneManager getInstance() {
        return m_instance;
    }


    public ZoneManager() {
        super(m_zonePath);
    }


</code></pre> 
<ul> 
 <li>The code of PersonManager :</li> 
</ul> 
<pre><code class="java">public class PersonManager extends DefaultReadOnlyResource {

    public static final String m_personName = &quot;person&quot;;

    public static final Path m_personPath = m_casaRootPath.add(Path.from(Path.SEPARATOR + m_personName));

    /**
     * Static instance of this singleton class
     */
    private static final PersonManager m_instance = new PersonManager();

    public static PersonManager getInstance() {
        return m_instance;
    }

    public PersonManager() {
        super(m_personPath);
    }
}
</code></pre> 
<h4 id="add_sub_resource_to_root">Add sub resource to root</h4> 
<p>In order to create the rest architecture create 3 class on the precedent model :</p> 
<ul> 
 <li><strong>PersonManager</strong> : 
  <ul> 
   <li><em>name</em> : “person”</li> 
   <li><em>path</em> : “/casa/person”</li> 
  </ul></li> 
 <li><strong>GenericDeviceManager</strong> : 
  <ul> 
   <li><em>name</em> : “devices”</li> 
   <li><em>path</em> : “/casa/devices”</li> 
  </ul></li> 
 <li><strong>ZoneManager</strong> : 
  <ul> 
   <li><em>name</em> : “zone”</li> 
   <li><em>path</em> : “/casa/zone”</li> 
  </ul></li> 
</ul> 
<p>We consider that by default this 3 resources are present. So to add this resources to the root we just have to modify the constructor :</p> 
<pre><code class="java">public CasaRootResource() {
    super(m_casaRootPath);
    m_casaResources.add(new GenericDeviceManager());
    m_casaResources.add(new PersonManager());
    m_casaResources.add(new ZoneManager());
}
</code></pre> 
<h4 id="relation_with_sub_resource">Relation with sub resource</h4> 
<p>So let’s do your first request on your domain. Send a <em>GET</em> request on the following adress: <a href="chrome-extension://hgmloofddffdnphfgcellkdfbfbjeloo/RestClient.html" title="http://localhost:8080/everest/casa">http://localhost:8080/everest/casa</a> The response will be :</p> 
<pre><code class="json">{
    __relations: {
    }-
    __observable: false
}
</code></pre> 
<p>But where are the sub resource that i just add ? The fact is that there are no implicit relation between a resource and its sub-resource. So let’s declare this relation ! We will override <em>getRelation</em> method in the root resource by adding a relations to each sub-resource it has.</p> 
<pre><code class="java">@Override
public List&lt;Relation&gt; getRelations() {
    List&lt;Relation&gt; relations = new ArrayList&lt;Relation&gt;();
    relations.addAll(super.getRelations());
    for (Resource resource : getResources()) {
        int size = getCanonicalPath().getCount();
        String name = resource.getCanonicalPath().getElements()[size];
        relations.add(new DefaultRelation(resource.getCanonicalPath(), Action.READ, getCanonicalPath().getLast() + &quot;:&quot; + name,
        &quot;Get &quot; + name));
    }
    return relations;
}
</code></pre> 
<p>This method will add a relation between the root resource and his sub-resources.</p> 
<p>So now if you re-do a <em>GET</em>, you will obtain :</p> 
<pre><code class="json">{
    __relations: {
        casa:devices: {
            href: &quot;http://localhost:8080/everest/casa/devices&quot;
            action: &quot;READ&quot;
            name: &quot;casa:devices&quot;
            description: &quot;Get devices&quot;
            parameters: [0]
        }-
        casa:person: {
            href: &quot;http://localhost:8080/everest/casa/person&quot;
            action: &quot;READ&quot;
            name: &quot;casa:person&quot;
            description: &quot;Get person&quot;
            parameters: [0]
        }-
        casa:zone: {
            href: &quot;http://localhost:8080/everest/casa/zone&quot;
            action: &quot;READ&quot;
            name: &quot;casa:zone&quot;
            description: &quot;Get zone&quot;
            parameters: [0]
        }-
    }-
    __observable: false
}
</code></pre> 
<p>We see that this method will be very efficient in every case where resource contains sub resource. So a good practice is to create the following class :</p> 
<pre><code class="java">public abstract class AbstractResourceCollection extends DefaultReadOnlyResource {

     /**
      * Constructor, same as {@code DefaultReadOnlyResource}
      *
      * @param path path of the resource
      */
     public AbstractResourceCollection(Path path) {
         super(path);
     }

     /**
      * Extracts the direct children and add a {@literal READ} relation to them.
      *
      * @return list of relations
      */
      @Override
     public List&lt;Relation&gt; getRelations() {
         List&lt;Relation&gt; relations = new ArrayList&lt;Relation&gt;();
         relations.addAll(super.getRelations());
         for (Resource resource : getResources()) {
             int size = getCanonicalPath().getCount();
             String name = resource.getCanonicalPath().getElements()[size];
             relations.add(new DefaultRelation(resource.getCanonicalPath(), Action.READ, getCanonicalPath().getLast() + &quot;:&quot; + name,
                     &quot;Get &quot; + name));
         }
         return relations;
     }
}
</code></pre> 
<p>Every class which contains sub resource will be <em>extend</em> AbstractResourceCollection.</p> 
<h4 id="how_everest_run_through_the_rest_architecture">How everest run through the ReST architecture</h4> 
<p>If you send a <em>GET</em> request to <a href="chrome-extension://hgmloofddffdnphfgcellkdfbfbjeloo/RestClient.html" title="http://localhost:8080/everest/casa">&quot;http://localhost:8080/everest/casa/zone&quot;</a></p> 
<pre><code class="json">{
__relations: {}
__observable: false
}
</code></pre> 
<p>But how the everest core can run through the architecture to <em>/zone</em> ? He start to the root and browse recursively the tree invoking the getResources method. So it’s very important to override the getResources method either the everest-core couldn’t browse the domain.</p> 
<h3 id="manage_your_resource">Manage your resource</h3> 
<p>In this part we are focusing on the devices branches. In this branches we have two resources :</p> 
<ul> 
 <li><strong>GenericDeviceManager</strong> : it represents the <em>/devices</em>, the root of all devices</li> 
 <li><strong>GenericDeviceResource</strong> : it represents the <em>/serialNumber</em>, it is the representation of a unique device.</li> 
</ul> 
<p>The device manager allowed us to manage a list of Device resource. Let’s implement the two class !</p> 
<p>The implementation of the device manager :</p> 
<pre><code class="java">public class GenericDeviceManager extends AbstractResourceCollection {

    /**
     * Name of the resource manager
     */
    public static final String m_genericDeviceName = &quot;devices&quot;;

    /**
     * Path of the resource manager, here /casa/devices
     */
    public static final Path m_genericDevicePath = m_casaRootPath.add(Path.from(Path.SEPARATOR + m_genericDeviceName));


    /**
     * Map of Generic Device resource by serial Number
     */
    private Map&lt;String, GenericDeviceResource&gt; m_genericDeviceResourcesMap = new HashMap&lt;String, GenericDeviceResource&gt;();

    /**
     * Static instance of this singleton class
     */
    private static final GenericDeviceManager m_instance = new GenericDeviceManager();

    /**
     * Getter of the static instance of this singleton class
     *
     * @return the singleton static instance
     */
    public static GenericDeviceManager getInstance() {
        return m_instance;
    }

    public GenericDeviceManager() {
        super(m_genericDevicePath);
    }

    @Override
    public List&lt;Resource&gt; getResources() {
        List&lt;Resource&gt; resources = new ArrayList&lt;Resource&gt;();
        for (String key : m_genericDeviceResourcesMap.keySet()) {
            resources.add(m_genericDeviceResourcesMap.get(key));
        }
        return resources;

    }
}
</code></pre> 
<p>The implementation of the device resource :</p> 
<pre><code class="java">public class GenericDeviceResource extends DefaultResource {


     /**
      * Represented resource
      */
     private final GenericDevice m_genericDevice;


     /**
      * Reference to resource manager
      */
     private final GenericDeviceManager m_genericDeviceManager;


     public GenericDeviceResource(GenericDevice genericDevice, GenericDeviceManager genericDeviceManager) {

         super(genericDeviceManager.m_genericDevicePath.add(Path.from(Path.SEPARATOR + genericDevice.DEVICE_SERIAL_NUMBER)));
         this.m_genericDevice = genericDevice;
         this.m_genericDeviceManager = genericDeviceManager;

     }
}
</code></pre> 
<h3 id="how_to_add_resource_to_my_manager_">How to add resource to my manager ?</h3> 
<p>By adding a <em>CREATE</em> relation in your manager.</p> 
<p>We proceed in two step to add the relation :</p> 
<ul> 
 <li>First : modify the manager constructor like this to add a relation :</li> 
</ul> 
<pre><code class="java">public GenericDeviceManager() {
    super(m_genericDevicePath);
    setRelations(
        new DefaultRelation(getPath(), Action.CREATE, &quot;create&quot;,
            new DefaultParameter()
                .name(&quot;serialNumber&quot;)
                    .description(&quot; Serial number of the device&quot;)
                    .optional(false)
                    .type(String.class)));
}
</code></pre> 
<ul> 
 <li>Second : implement the method <em>create</em> witch is called by the relation <em>CREATE</em> :</li> 
</ul> 
<pre><code class="java">public Resource create(Request request) {
    GenericDeviceResource resource = null;

     /* Catch of the request argument */
     String newSerialNumber = request.get(&quot;serialNumber&quot;, String.class);
     if (newSerialNumber != null) {

        /* Creation of a New Device */
        GenericDevice newGenericDevice = new GenericDevice(newSerialNumber);

        /* Creation of the resource which represent the device */
        resource = new GenericDeviceResource(newGenericDevice, this);

        /* Add the resource to the Map of sub resource*/
        m_genericDeviceResourcesMap.put(newGenericDevice.DEVICE_SERIAL_NUMBER, resource);
     }
    return resource;
}
</code></pre> 
<h3 id="how_to_add_metadata_to_my_resource_">How to add Metadata to my resource ?</h3> 
<p>You must modify the Generic device resource like this :</p> 
<pre><code class="java">public ResourceMetadata getMetadata() {
    ImmutableResourceMetadata.Builder metadataBuilder = new ImmutableResourceMetadata.Builder();
    metadataBuilder.set(&quot;Serial Number&quot;, m_genericDevice.DEVICE_SERIAL_NUMBER);
    metadataBuilder.set(&quot;State Activated&quot;, m_genericDevice.STATE_ACTIVATED);
    metadataBuilder.set(&quot;State Deactivated&quot;, m_genericDevice.STATE_DEACTIVATED);
    metadataBuilder.set(&quot;State Property Name&quot;, m_genericDevice.STATE_PROPERTY_NAME);
    metadataBuilder.set(&quot;Serial Unknown&quot;, m_genericDevice.STATE_UNKNOWN);
    return metadataBuilder.build();
}
</code></pre> 
<p>Now when you send a get command you have the metadata print in the answer.</p> 
<h3 id="update"> How to interact with the object represented by the resource ?</h3> 
<p>With adding a <em>UPDATE</em> relation in your manager.</p> 
<p>We proceed in two step to add the relation :</p> 
<ul> 
 <li>First : modify the manager constructor like this to add a relation :</li> 
</ul> 
<pre><code class="java">public GenericDeviceResource(GenericDevice genericDevice, GenericDeviceManager genericDeviceManager) {

    super(genericDeviceManager.m_genericDevicePath.add(Path.from(Path.SEPARATOR + genericDevice.DEVICE_SERIAL_NUMBER)));
    this.m_genericDevice = genericDevice;
    this.m_genericDeviceManager = genericDeviceManager;
    new DefaultRelation(getPath(), Action.UPDATE, &quot;Update field&quot;,
        new DefaultParameter()
            .name(&quot;parameter/value&quot;)
            .description(&quot; Modify the parameter of the device with the value&quot;)
            .optional(false)
            .type(Map.class));

}

</code></pre> 
<ul> 
 <li>Second : implement the method <em>update</em> witch is called by the relation <em>UPDATE</em> :</li> 
</ul> 
<pre><code class="java">@Override
public Resource update(Request request) throws IllegalActionOnResourceException {
    Map&lt;String, ?&gt; newMap = request.parameters();
    if (newMap != null) {
        for (String key : newMap.keySet()) {
            if (key.contentEquals(&quot;STATE_DEACTIVATED&quot;))
                m_genericDevice.setSTATE_DEACTIVATED(newMap.get(key).toString());
        }
    }
    return this;
}
</code></pre> 
<h2 id="manage_your_relation">Manage your relation</h2> 
<h3 id="relation_between_2_resources">Relation between 2 resources</h3> 
<p>In our example, each device will be located in one zone. And, in a zone, we could have several devices. This fact will be represented by <strong>relations</strong>.</p> 
<h4 id="relation_device__zone">Relation device –&gt; zone.</h4> 
<p>Let’s implement the relation in the DeviceResource. We imagine that a device is not fixed in the space, it can be move to an other zone. In rest the action is traduce by an <em>UPDATE</em> action on the resource. This action have already been implemented in <a href="#update" title="How to interact with the object represented by the resource ?">How to interact with the object represented by the resource ?</a>. We just have to add a new case when we see the key word <em>zone</em>.</p> 
<pre><code class="java">else if  (key.contentEquals(&quot;zone&quot;)){
    m_genericDevice.zone =  newMap.get(key).toString();
    Relation  relations = new DefaultRelation(ZoneManager.getInstance().getPath().add(Path.from(Path.SEPARATOR + m_genericDevice.zone )), Action.READ, &quot;Location&quot;);
    setRelations(relations);
}
</code></pre> 
<p>So now if your update,with the ReST client, a device with a <em>POST</em> request (first parameter : zone, second parameter : bathroom) and do a <em>GET</em> request on the DeviceResource, we will see the relation called “Location” :</p> 
<pre><code class="json">__relations: {
    Location: {
         href: &quot;http://localhost:8080/everest/casa/zone/bathroom&quot;
         action: &quot;READ&quot;
         name: &quot;Location&quot;
        description: null
        parameters: [0]
    }-
}
</code></pre> 
<p>But when we do a <em>GET</em> on <a href="chrome-extension://hgmloofddffdnphfgcellkdfbfbjeloo/RestClient.html" title="http://localhost:8080/everest/casa">http://localhost:8080/everest/casa/zone/bathroom</a> we see :</p> 
<pre><code class="json">{
    Name: &quot;bathroom&quot;
    Luminosity: &quot;10&quot;
    __relations: {}-
    __observable: false
}
</code></pre> 
<p>There is not the relation ! So let’s do the second part in order to see how implement the relation between the bathroom and the device present in this zone.</p> 
<h4 id="relation_device__zone1">Relation device &lt;– zone.</h4> 
<p>When you update the location of a device you want that a relation between the zone and the device may be implemented too. In order too we implement two method in ZoneResource :</p> 
<ul> 
 <li>setDeviceLocation(String serialNumber) : this method add a relation between the zone and a device identified by the serial number. It will used if a device appear in the zone.</li> 
 <li>deleteDeviceLocation(String serialNumber) : this method delete a relation between the zone and a device identified by the serial number. It will used if a device is moved out of the zone.</li> 
</ul> 
<pre><code class="java">public void deleteDeviceLocation(String serialNumber) {
    List&lt;Relation&gt; relations ;

    /*Browse the relation list until we find the relation corresponding to the relation that we want to delete*/
    for (Relation current : getRelations()){
        if(current.getName().equalsIgnoreCase(&quot;device&quot;+serialNumber)){
            relations = getRelations();
            relations.remove(current) ;
            setRelations(relations);
        }
    }
}

public void setDeviceLocation(String serialNumber) {
    List&lt;Relation&gt; relations ;

    /* save the all relation */
    relations = getRelations();

    /* add or update the relation with the device */
    relations.add(new DefaultRelation(GenericDeviceManager.getInstance().getPath().add(Path.from(Path.SEPARATOR + serialNumber)), Action.READ, &quot;device&quot;+serialNumber)) ;
    setRelations(relations);
}
</code></pre> 
<p>Then this operation will be manage by the ZoneManager. So we need to declare a new field in the zone manager which contain the serialnumber of a device and the location of a device.This Map will be update each time that a device moved.</p> 
<pre><code class="java">/**
* Map of Generic Device resource by serial Number
*/
private Map&lt;String, String&gt; m_genericDeviceByZone = new HashMap&lt;String, String&gt;();
</code></pre> 
<p>To finish we need to create the method which update the relation between the zone and the device :</p> 
<pre><code class="java">public void setChildLocation(String serialNumber,String Location) {

    /* if the relation relation already exist, we delete the precedent relation before create a new one */
    if(m_genericDeviceByZone.get(serialNumber) != null) {
        m_zoneResourcesMap.get(m_genericDeviceByZone.get(serialNumber)).deleteDeviceLocation(serialNumber);
    }

    /* Add the device to the list or replace the old location */
    m_genericDeviceByZone.put(serialNumber,Location);
    for (String key : m_zoneResourcesMap.keySet()){

        /* If the new location exist in the sub resource, a relation between the device and the sub resource will be create */
        if (m_zoneResourcesMap.get(key).getPath().getLast().toString().equalsIgnoreCase(Location)){
        m_zoneResourcesMap.get(key).setDeviceLocation(serialNumber);
        }
    }
}
</code></pre> 
<p>This method will be called each time we <em>UPDATE</em> the device’s zone :</p> 
<pre><code class="java">else if  (key.contentEquals(&quot;zone&quot;)){
    m_genericDevice.zone =  newMap.get(key).toString();
    Relation  relations = new DefaultRelation(ZoneManager.getInstance().getPath().add(Path.from(Path.SEPARATOR + m_genericDevice.zone )), Action.READ, &quot;Location&quot;);
    setRelations(relations);
    ZoneManager.getInstance().setChildLocation(m_genericDevice.DEVICE_SERIAL_NUMBER,newMap.get(key).toString());
}
</code></pre> 
<p>So now after <em>UPDATE</em> a device’s zone, when we do a <em>GET</em> on the zone we will see :</p> 
<pre><code class="json">{
    Name: &quot;bathroom&quot;
    Luminosity: &quot;10&quot;
    __relations: {
        device10: {
            href: &quot;http://localhost:8080/everest/casa/devices/10&quot;
            action: &quot;READ&quot;
            name: &quot;device10&quot;
            description: null
            parameters: [0]
        }-
    }-
    __observable: false
}
</code></pre>
			</div>
		</div>
		<div class="span4">
			<div id="toc-sidebar">
				<div class="well">
					<ul class="nav nav-list">
						<li class="nav-header">Table of Contents</li>
		<li class="dropdown"><a href="#hello_everest" title="Hello Everest!">Hello Everest! <b class="caret"></b></a>
			<ul class="nav nav-list">
		<li><a href="#requirement" title="Requirement">Requirement</a>
		<li class="dropdown"><a href="#general_purpose_about_domain" title="General purpose about domain">General purpose about domain <b class="caret"></b></a>
			<ul class="nav nav-list">
		<li><a href="#what_is_a_domain_" title="What is a domain ?">What is a domain ?</a>
		<li><a href="#first_step__identify_your_resources" title="First step : identify your resources">First step : identify your resources</a>
		<li><a href="#everest_in_all_this" title="Everest in all this">Everest in all this</a>
				<li class="divider"></li>
			</ul>
		</li>
		<li class="dropdown"><a href="#build_your_domain" title="Build your domain">Build your domain <b class="caret"></b></a>
			<ul class="nav nav-list">
		<li class="dropdown"><a href="#the_root_resource" title="The root resource">The root resource <b class="caret"></b></a>
			<ul class="nav nav-list">
		<li><a href="#add_sub_resource_to_root" title="Add sub resource to root">Add sub resource to root</a>
		<li><a href="#relation_with_sub_resource" title="Relation with sub resource">Relation with sub resource</a>
		<li><a href="#how_everest_run_through_the_rest_architecture" title="How everest run through the ReST architecture">How everest run through the ReST architecture</a>
				<li class="divider"></li>
			</ul>
		</li>
		<li><a href="#manage_your_resource" title="Manage your resource">Manage your resource</a>
		<li><a href="#how_to_add_resource_to_my_manager_" title="How to add resource to my manager ?">How to add resource to my manager ?</a>
		<li><a href="#how_to_add_metadata_to_my_resource_" title="How to add Metadata to my resource ?">How to add Metadata to my resource ?</a>
		<li><a href="#update" title="How to interact with the object represented by the resource ?">How to interact with the object represented by the resource ?</a>
				<li class="divider"></li>
			</ul>
		</li>
		<li class="dropdown"><a href="#manage_your_relation" title="Manage your relation">Manage your relation <b class="caret"></b></a>
			<ul class="nav nav-list">
		<li class="dropdown"><a href="#relation_between_2_resources" title="Relation between 2 resources">Relation between 2 resources <b class="caret"></b></a>
			<ul class="nav nav-list">
		<li><a href="#relation_device__zone" title="Relation device –> zone.">Relation device –> zone.</a>
		<li><a href="#relation_device__zone1" title="Relation device <– zone.">Relation device <– zone.</a>
				<li class="divider"></li>
			</ul>
		</li>
			</ul>
		</li>
			</ul>
		</li>
					</ul>
				</div>
			</div>
		</div>
	</div>
	</div>

	</div><!-- /container -->
	
	<!-- Footer
	================================================== -->
	<footer class="well">
		<div class="container">
			<div class="row">
				<div class="span3 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Main</li>
						<li>
							<a href="about.html" title="everest">everest </a>
						</li>
						<li>
							<a href="everest-core/index.html" title="everest-core">everest-core </a>
						</li>
						<li>
							<a href="everest-osgi/index.html" title="everest-OSGi">everest-OSGi </a>
						</li>
						<li>
							<a href="everest-ipojo/index.html" title="everest-iPOJO">everest-iPOJO </a>
						</li>
						<li>
							<a href="everest-servlet/index.html" title="everest-servlet">everest-servlet </a>
						</li>
						<li>
							<a href="everest-system/index.html" title="everest-System">everest-System </a>
						</li>
						<li>
							<a href="http://github.com/ow2-chameleon/everest" title="GitHub project" class="externalLink">GitHub project </a>
						</li>
					</ul>
				</div>
				<div class="span3 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Contribute</li>
						<li>
							<a href="contribution.html" title="Contribute">Contribute </a>
						</li>
						<li>
							<a href="source-repository.html" title="Sources">Sources </a>
						</li>
						<li>
							<a href="http://github.com/ow2-chameleon/everest/issues/" title="Issues" class="externalLink">Issues </a>
						</li>
						<li>
							<a href="http://github.com/ow2-chameleon/everest" title="Fork on GitHub" class="externalLink">Fork on GitHub </a>
						</li>
					</ul>
				</div>
				<div class="span3 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Download</li>
						<li>
							<a href="downloads.html" title="Download">Download </a>
						</li>
						<li>
							<a href="license.html" title="License">License </a>
						</li>
					</ul>
				</div>
				<div class="span3 bottom-description">
					<blockquote><span class="color-highlight">OW2 Chameleon Everest</span> ~ Will kick your ass.</blockquote>
				</div>
			</div>
		</div>
	</footer>
		
	<div class="container subfooter">
		<div class="row">
			<div class="span12">
				<p class="pull-right"><a href="#">Back to top</a></p>
				<p class="copyright">Copyright &copy;2009-2014 <a href="http://ow2.org">OW2 Chameleon</a>. All Rights Reserved.</p>
				<p class="version-date"><span class="projectVersion">Version: 1.0-SNAPSHOT. </span><span class="publishDate">Last Published: 2014-01-31. </span></p>
			</div>
		</div>
	</div>

	<!-- Le javascript
	================================================== -->
	<!-- Placed at the end of the document so the pages load faster -->

	<!-- Fallback jQuery loading from Google CDN:
	     http://stackoverflow.com/questions/1014203/best-way-to-use-googles-hosted-jquery-but-fall-back-to-my-hosted-library-on-go -->
	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
	<script type="text/javascript">
		if (typeof jQuery == 'undefined')
		{
			document.write(unescape("%3Cscript src='./js/jquery-1.8.3.min.js' type='text/javascript'%3E%3C/script%3E"));
		}
	</script>
	
	<script src="./js/bootstrap.min.js"></script>
	<script src="./js/lightbox.js"></script>
	<script src="./js/jquery.smooth-scroll.min.js"></script>
	<!-- back button support for smooth scroll -->
	<script src="./js/jquery.ba-bbq.min.js"></script>
	<script src="http://yandex.st/highlightjs/7.3/highlight.min.js"></script>

	<script src="./js/reflow-skin.js"></script>
	
	</body>
</html>
