<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia at 2013-08-28
 | Rendered using Apache Maven Fluido Skin 1.3.0
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20130828" />
    <meta http-equiv="Content-Language" content="en" />
    <title>everest - </title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.3.0.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />

      
    <script type="text/javascript" src="./js/apache-maven-fluido-1.3.0.min.js"></script>

                          
        
<link rel="stylesheet" type="text/css" href="http://bourretp.github.io/everest/snapshot/css/site.css"/>
                      
        
<link rel="stylesheet" type="text/css" href="http://bourretp.github.io/everest/snapshot/css/bootstrap.css"/>
                      
        
<link rel="stylesheet" type="text/css" href="http://bourretp.github.io/everest/snapshot/css/custom.css"/>
                      
        
<link rel="stylesheet" type="text/css" href="http://bourretp.github.io/everest/snapshot/css/fonts.css"/>
                      
        
<link rel="stylesheet" type="text/css" href="http://bourretp.github.io/everest/snapshot/css/color_schemes.css"/>
          
            </head>
        <body class="topBarDisabled">
          
    
    
            
    
        
    <a href="http://github.com/99soft/backport-spi">
      <img style="position: absolute; top: 0; right: 0; border: 0; z-index: 10000;"
        src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png"
        alt="Fork me on GitHub">
    </a>
  
                
                    
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                                  <a href="#" id="bannerLeft">
                                                                                                <img src="images/everest-logo.png"  alt="everest"/>
                </a>
                      </div>
        <div class="pull-right">  </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
                    
                  <li id="publishDate">Last Published: 2013-08-28</li>
                  <li class="divider">|</li> <li id="projectVersion">Version: 1.0-SNAPSHOT</li>
                      
                
                    
      
                            </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span3">
          <div class="well sidebar-nav">
                
                    
                <ul class="nav nav-list">
                    <li class="nav-header">everest</li>
                                
      <li>
    
                          <a href="about.html" title="About">
          <i class="none"></i>
        About</a>
            </li>
                  
      <li>
    
                          <a href="downloads.html" title="Downloads">
          <i class="none"></i>
        Downloads</a>
            </li>
                  
      <li>
    
                          <a href="documentation.html" title="Documentation">
          <i class="none"></i>
        Documentation</a>
            </li>
                  
      <li class="active">
    
            <a href="#"><i class="none"></i>Hello Everest!</a>
          </li>
                              <li class="nav-header">everest-core</li>
                                
      <li>
    
                          <a href="everest-core/index.html" title="Home">
          <i class="none"></i>
        Home</a>
            </li>
                  
      <li>
    
                          <a href="everest-core/getting-started.html" title="Getting Started">
          <i class="none"></i>
        Getting Started</a>
            </li>
                  
      <li>
    
                          <a href="everest-core/concepts.html" title="Concepts">
          <i class="none"></i>
        Concepts</a>
            </li>
                              <li class="nav-header">everest-servlet</li>
                                
      <li>
    
                          <a href="everest-servlet/index.html" title="Home">
          <i class="none"></i>
        Home</a>
            </li>
                              <li class="nav-header">everest-System</li>
                                
      <li>
    
                          <a href="everest-system/index.html" title="Home">
          <i class="none"></i>
        Home</a>
            </li>
                              <li class="nav-header">everest-OSGi</li>
                                
      <li>
    
                          <a href="everest-osgi/index.html" title="Home">
          <i class="none"></i>
        Home</a>
            </li>
                  
      <li>
    
                          <a href="everest-osgi/index.html#tutorials" title="Tutorials">
          <i class="none"></i>
        Tutorials</a>
            </li>
                  
      <li>
    
                          <a href="everest-osgi/index.html#osgi-root-resource" title="Root">
          <i class="none"></i>
        Root</a>
            </li>
                  
      <li>
    
                          <a href="everest-osgi/index.html#bundle" title="Bundles">
          <i class="none"></i>
        Bundles</a>
            </li>
                  
      <li>
    
                          <a href="everest-osgi/index.html#package" title="Packages">
          <i class="none"></i>
        Packages</a>
            </li>
                  
      <li>
    
                          <a href="everest-osgi/index.html#service" title="Services">
          <i class="none"></i>
        Services</a>
            </li>
                  
      <li>
    
                          <a href="everest-osgi/index.html#configuration" title="Configurations">
          <i class="none"></i>
        Configurations</a>
            </li>
                  
      <li>
    
                          <a href="everest-osgi/index.html#log-entry" title="Logs">
          <i class="none"></i>
        Logs</a>
            </li>
                  
      <li>
    
                          <a href="everest-osgi/index.html#deployment-package" title="Deployment Packages">
          <i class="none"></i>
        Deployment Packages</a>
            </li>
                              <li class="nav-header">everest-iPOJO</li>
                                
      <li>
    
                          <a href="everest-ipojo/index.html" title="Home">
          <i class="none"></i>
        Home</a>
            </li>
                  
      <li>
    
                          <a href="everest-ipojo/ReferenceCard.html" title="Reference Card">
          <i class="none"></i>
        Reference Card</a>
            </li>
                  
      <li>
    
                          <a href="everest-ipojo/Root.html" title="Root">
          <i class="none"></i>
        Root</a>
            </li>
                  
      <li>
    
                          <a href="everest-ipojo/Instances.html" title="Instances">
          <i class="none"></i>
        Instances</a>
            </li>
                  
      <li>
    
                          <a href="everest-ipojo/ServiceDependencies.html" title="Instance service dependencies">
          <i class="none"></i>
        Instance service dependencies</a>
            </li>
                  
      <li>
    
                          <a href="everest-ipojo/ServiceProvidings.html" title="Instance service providings">
          <i class="none"></i>
        Instance service providings</a>
            </li>
                  
      <li>
    
                          <a href="everest-ipojo/Factories.html" title="Factories">
          <i class="none"></i>
        Factories</a>
            </li>
                  
      <li>
    
                          <a href="everest-ipojo/Handlers.html" title="Handlers">
          <i class="none"></i>
        Handlers</a>
            </li>
                  
      <li>
    
                          <a href="everest-ipojo/InstanceDeclarations.html" title="Instance declarations">
          <i class="none"></i>
        Instance declarations</a>
            </li>
                  
      <li>
    
                          <a href="everest-ipojo/TypeDeclarations.html" title="Type declarations">
          <i class="none"></i>
        Type declarations</a>
            </li>
                  
      <li>
    
                          <a href="everest-ipojo/ExtensionDeclarations.html" title="Extension declarations">
          <i class="none"></i>
        Extension declarations</a>
            </li>
                              <li class="nav-header">Project Documentation</li>
                                                                                                                                                                                                                                                                                                                                              
      <li>
    
                          <a href="project-info.html" title="Project Information">
          <i class="icon-chevron-right"></i>
        Project Information</a>
                  </li>
                                                                    
      <li>
    
                          <a href="project-reports.html" title="Project Reports">
          <i class="icon-chevron-right"></i>
        Project Reports</a>
                  </li>
            </ul>
                
                    
                
          <hr class="divider" />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span9" >
                                  
            <h1>Hello Everest!</h1><p>Here goes the Everest, Aconcagua and other Seven Summits.</p><h2>Requirement</h2><p>In order to follow the tutorial, you need to download :</p>
<ul>
  <li>This OSGi framework ( based on Chameleon ). You can download and build the test distribution from everest-distrib.</li>
  <li>A ReST plug-in for your browser to interact with your domain( google chrome : <a href="https://chrome.google.com/webstore/detail/advanced-rest-client/hgmloofddffdnphfgcellkdfbfbjeloo" title="Advanced Rest Client">Advanced ReST Client</a>, mozilla : <a href="https://addons.mozilla.org/fr/firefox/addon/restclient/" title="restClient">restClient</a>).</li>
</ul><p>Additionally, you need to have read the part about <strong><a href="everest-core/concepts.html">concept</a></strong> and <strong><a href="everest-core/getting-started.html">getting started</a></strong>.</p><p><strong>NB</strong> : In order to launch the everest-distrib, do :</p>
<ul>
  <li>Linux : launch the chameleon script ( <em>command</em> : <code>./chameleon.sh --interactive</code>)</li>
  <li>Windows : use the following <em>command</em> : <code>java -jar .\bin\chameleon-core-1.0.0-SNAPSHOT.jar --interactive</code></li>
</ul><h2>General purpose about domain</h2><h3>What is a domain ?</h3><p>A domain is a set of resources representing a particular context. The level of granularity of resources is defined by the designer of the domain.</p><h3>First step : identify your resources</h3><p>In this tutorial, the domain we will represent is the house. So the first and primordial step is to identify the several resources of the domain.</p><p>For this example we choose to represent the house like this : <img src="everest-casa.png"  alt="&amp;ldquo;Representation of the house&amp;rdquo;"/></p>
<ul>
  <li><strong>Device</strong> : represents all the electronic equipment in the house (binarylight, sensors, cooler&hellip;), each device is defined by a serial number.</li>
  <li><strong>Person</strong> : represents the inhabitant of the house.</li>
  <li><strong>Zone</strong> : represents the different parts of the house(kitchen, bathroom&hellip;).</li>
</ul><p>The granularity of the resources is defined by the designer of the domain. Indeed, we can detail the device resource in sub-resource as:</p>
<ul>
  <li><strong>Light</strong> : every equipment in relation with luminosity (binaryLight, photometer&hellip;).</li>
  <li><strong>Heat</strong> : every equipment in relation with temperature (heater, thermometer&hellip;).</li>
  <li><strong>Music</strong> : every equipment in relation with sound (speaker, audio source&hellip;).</li>
</ul><h3>Everest in all this</h3><p>Everest is a resources manager which allowed to translate the precedent representation in a ReST way. In our case the ReST layout is :</p>
<ul>
  <li><strong>/casa</strong> - The root of the everest Casa domain.
  <ul>
    <li><strong>/devices</strong>
    <ul>
      <li><strong>$serialNumber</strong> - The device identified by <em>$serialNumber</em>.</li>
    </ul></li>
    <li><strong>/person</strong></li>
    <li><strong>/zone</strong>
    <ul>
      <li><strong>/$nameZone</strong> - The zone named <em>$nameZone</em>.</li>
    </ul></li>
  </ul></li>
</ul><h2>Build your domain</h2><h3>The root resource</h3><p>The starting point of each domain is the root resource. It contains all the sub resource of the domain. In our case the root resource is Casa. So let&rsquo;s implement your first resource !</p>
<pre><code class="java">public class CasaRootResource extends DefaultReadOnlyResource {

    /**
     * Name of the resource
     */
    public static final String m_casaRoot = &quot;casa&quot;;

    /**
     * Path of the resource : /casa
     */
    public static final Path m_casaRootPath = Path.from(Path.SEPARATOR + m_casaRoot);

    /**
     * Description of the resource
     */
    private static final String m_casaDescription = &quot;casa resources&quot;;

    /**
     * List of the subResource : Contains the direct sub resource of root
     */
    private final List&lt;Resource&gt; m_casaResources = new ArrayList&lt;Resource&gt;();

    /**
     * Constructor of Casa
     */
    public CasaRootResource() {
        super(m_casaRootPath);
    }

    /**
     * Extract the sub resource of casa
     */
    @Override
    public List&lt;Resource&gt; getResources() {
        return m_casaResources;
    }
}
</code></pre><p>In order to create the resource hierarchy,we create 3 class PersonManager, GenericDeviceManager and ZoneManager.</p>
<ul>
  <li>The code of GenericDeviceManager :</li>
</ul>
<pre><code class="java">public class GenericDeviceManager extends DefaultReadOnlyResource {

    /**
     * Name of the resource manager
     */
    public static final String m_genericDeviceName = &quot;devices&quot;;

    /**
     * Path of the resource manager, here /casa/devices
     */
    public static final Path m_genericDevicePath = m_casaRootPath.add(Path.from(Path.SEPARATOR + m_genericDeviceName));

    /**
     * Static instance of this singleton class
     */
    private static final GenericDeviceManager m_instance = new GenericDeviceManager();

    /**
     * Getter of the static instance of this singleton class
     *
     * @return the singleton static instance
     */
    public static GenericDeviceManager getInstance() {
        return m_instance;
    }

    public GenericDeviceManager() {
        super(m_genericDevicePath);
    }

}
</code></pre>
<ul>
  <li>The code of ZoneManager :</li>
</ul>
<pre><code class="java">public class ZoneManager extends DefaultReadOnlyResource {

    public static final String m_zoneName = &quot;zone&quot;;

    public static final Path m_zonePath = m_casaRootPath.add(Path.from(Path.SEPARATOR + m_zoneName));

    /**
     * Static instance of this singleton class
     */
    private static final ZoneManager m_instance = new ZoneManager();

    public static ZoneManager getInstance() {
        return m_instance;
    }


    public ZoneManager() {
        super(m_zonePath);
    }


</code></pre>
<ul>
  <li>The code of PersonManager :</li>
</ul>
<pre><code class="java">public class PersonManager extends DefaultReadOnlyResource {

    public static final String m_personName = &quot;person&quot;;

    public static final Path m_personPath = m_casaRootPath.add(Path.from(Path.SEPARATOR + m_personName));

    /**
     * Static instance of this singleton class
     */
    private static final PersonManager m_instance = new PersonManager();

    public static PersonManager getInstance() {
        return m_instance;
    }

    public PersonManager() {
        super(m_personPath);
    }
}
</code></pre><h4>Add sub resource to root</h4><p>In order to create the rest architecture create 3 class on the precedent model :</p>
<ul>
  <li><strong>PersonManager</strong> :
  <ul>
    <li><em>name</em> : &ldquo;person&rdquo;</li>
    <li><em>path</em> : &ldquo;/casa/person&rdquo;</li>
  </ul></li>
  <li><strong>GenericDeviceManager</strong> :
  <ul>
    <li><em>name</em> : &ldquo;devices&rdquo;</li>
    <li><em>path</em> : &ldquo;/casa/devices&rdquo;</li>
  </ul></li>
  <li><strong>ZoneManager</strong> :
  <ul>
    <li><em>name</em> : &ldquo;zone&rdquo;</li>
    <li><em>path</em> : &ldquo;/casa/zone&rdquo;</li>
  </ul></li>
</ul><p>We consider that by default this 3 resources are present. So to add this resources to the root we just have to modify the  constructor :</p>
<pre><code class="java">public CasaRootResource() {
    super(m_casaRootPath);
    m_casaResources.add(new GenericDeviceManager());
    m_casaResources.add(new PersonManager());
    m_casaResources.add(new ZoneManager());
}
</code></pre><h4>Relation with sub resource</h4><p>So let&rsquo;s do your first request on your domain. Send a <em>GET</em> request on the following adress: <a href="chrome-extension://hgmloofddffdnphfgcellkdfbfbjeloo/RestClient.html" title="http://localhost:8080/everest/casa">http://localhost:8080/everest/casa</a> The response will be :</p>
<pre><code class="json">{
    __relations: {
    }-
    __observable: false
}
</code></pre><p>But where are the sub resource that i just add ? The fact is that there are no implicit relation between a resource and its sub-resource. So let&rsquo;s declare this relation ! We will override <em>getRelation</em> method in the root resource by adding a relations to each sub-resource it has.</p>
<pre><code class="java">@Override
public List&lt;Relation&gt; getRelations() {
    List&lt;Relation&gt; relations = new ArrayList&lt;Relation&gt;();
    relations.addAll(super.getRelations());
    for (Resource resource : getResources()) {
        int size = getCanonicalPath().getCount();
        String name = resource.getCanonicalPath().getElements()[size];
        relations.add(new DefaultRelation(resource.getCanonicalPath(), Action.READ, getCanonicalPath().getLast() + &quot;:&quot; + name,
        &quot;Get &quot; + name));
    }
    return relations;
}
</code></pre><p>This method will add a relation between the root resource and his sub-resources.</p><p>So now if you re-do a <em>GET</em>, you will obtain :</p>
<pre><code class="json">{
    __relations: {
        casa:devices: {
            href: &quot;http://localhost:8080/everest/casa/devices&quot;
            action: &quot;READ&quot;
            name: &quot;casa:devices&quot;
            description: &quot;Get devices&quot;
            parameters: [0]
        }-
        casa:person: {
            href: &quot;http://localhost:8080/everest/casa/person&quot;
            action: &quot;READ&quot;
            name: &quot;casa:person&quot;
            description: &quot;Get person&quot;
            parameters: [0]
        }-
        casa:zone: {
            href: &quot;http://localhost:8080/everest/casa/zone&quot;
            action: &quot;READ&quot;
            name: &quot;casa:zone&quot;
            description: &quot;Get zone&quot;
            parameters: [0]
        }-
    }-
    __observable: false
}
</code></pre><p>We see that this method will be very efficient in every case where resource contains sub resource. So a good practice is to create the following class :</p>
<pre><code class="java">public abstract class AbstractResourceCollection extends DefaultReadOnlyResource {

     /**
      * Constructor, same as {@code DefaultReadOnlyResource}
      *
      * @param path path of the resource
      */
     public AbstractResourceCollection(Path path) {
         super(path);
     }

     /**
      * Extracts the direct children and add a {@literal READ} relation to them.
      *
      * @return list of relations
      */
      @Override
     public List&lt;Relation&gt; getRelations() {
         List&lt;Relation&gt; relations = new ArrayList&lt;Relation&gt;();
         relations.addAll(super.getRelations());
         for (Resource resource : getResources()) {
             int size = getCanonicalPath().getCount();
             String name = resource.getCanonicalPath().getElements()[size];
             relations.add(new DefaultRelation(resource.getCanonicalPath(), Action.READ, getCanonicalPath().getLast() + &quot;:&quot; + name,
                     &quot;Get &quot; + name));
         }
         return relations;
     }
}
</code></pre><p>Every class which contains sub resource will be <em>extend</em> AbstractResourceCollection.</p><h4>How everest run through the ReST architecture</h4><p>If you send a <em>GET</em> request to <a href="chrome-extension://hgmloofddffdnphfgcellkdfbfbjeloo/RestClient.html" title="http://localhost:8080/everest/casa">&quot;http://localhost:8080/everest/casa/zone&quot;</a></p>
<pre><code class="json">{
__relations: {}
__observable: false
}
</code></pre><p>But how the everest core can run through the architecture to <em>/zone</em> ? He start to the root and browse recursively the tree invoking the getResources method. So it&rsquo;s very important to override the getResources method either the everest-core couldn&rsquo;t browse the domain.</p><h3>Manage your resource</h3><p>In this part we are focusing on the devices branches. In this branches we have two resources :</p>
<ul>
  <li><strong>GenericDeviceManager</strong> : it represents the <em>/devices</em>, the root of all devices</li>
  <li><strong>GenericDeviceResource</strong> : it represents the <em>/serialNumber</em>, it is the representation of a unique device.</li>
</ul><p>The device manager allowed us to manage a list of Device resource. Let&rsquo;s implement the two class !</p><p>The implementation of the device manager :</p>
<pre><code class="java">public class GenericDeviceManager extends AbstractResourceCollection {

    /**
     * Name of the resource manager
     */
    public static final String m_genericDeviceName = &quot;devices&quot;;

    /**
     * Path of the resource manager, here /casa/devices
     */
    public static final Path m_genericDevicePath = m_casaRootPath.add(Path.from(Path.SEPARATOR + m_genericDeviceName));


    /**
     * Map of Generic Device resource by serial Number
     */
    private Map&lt;String, GenericDeviceResource&gt; m_genericDeviceResourcesMap = new HashMap&lt;String, GenericDeviceResource&gt;();

    /**
     * Static instance of this singleton class
     */
    private static final GenericDeviceManager m_instance = new GenericDeviceManager();

    /**
     * Getter of the static instance of this singleton class
     *
     * @return the singleton static instance
     */
    public static GenericDeviceManager getInstance() {
        return m_instance;
    }

    public GenericDeviceManager() {
        super(m_genericDevicePath);
    }

    @Override
    public List&lt;Resource&gt; getResources() {
        List&lt;Resource&gt; resources = new ArrayList&lt;Resource&gt;();
        for (String key : m_genericDeviceResourcesMap.keySet()) {
            resources.add(m_genericDeviceResourcesMap.get(key));
        }
        return resources;

    }
}
</code></pre><p>The implementation of the device resource :</p>
<pre><code class="java">public class GenericDeviceResource extends DefaultResource {


     /**
      * Represented resource
      */
     private final GenericDevice m_genericDevice;


     /**
      * Reference to resource manager
      */
     private final GenericDeviceManager m_genericDeviceManager;


     public GenericDeviceResource(GenericDevice genericDevice, GenericDeviceManager genericDeviceManager) {

         super(genericDeviceManager.m_genericDevicePath.add(Path.from(Path.SEPARATOR + genericDevice.DEVICE_SERIAL_NUMBER)));
         this.m_genericDevice = genericDevice;
         this.m_genericDeviceManager = genericDeviceManager;

     }
}
</code></pre><h3>How to add resource to my manager ?</h3><p>By adding a <em>CREATE</em> relation in your manager.</p><p>We proceed in two step to add the relation :</p>
<ul>
  <li>First : modify the manager constructor like this to add a relation :</li>
</ul>
<pre><code class="java">public GenericDeviceManager() {
    super(m_genericDevicePath);
    setRelations(
        new DefaultRelation(getPath(), Action.CREATE, &quot;create&quot;,
            new DefaultParameter()
                .name(&quot;serialNumber&quot;)
                    .description(&quot; Serial number of the device&quot;)
                    .optional(false)
                    .type(String.class)));
}
</code></pre>
<ul>
  <li>Second : implement the method <em>create</em> witch is called by the relation <em>CREATE</em> :</li>
</ul>
<pre><code class="java">public Resource create(Request request) {
    GenericDeviceResource resource = null;

     /* Catch of the request argument */
     String newSerialNumber = request.get(&quot;serialNumber&quot;, String.class);
     if (newSerialNumber != null) {

        /* Creation of a New Device */
        GenericDevice newGenericDevice = new GenericDevice(newSerialNumber);

        /* Creation of the resource which represent the device */
        resource = new GenericDeviceResource(newGenericDevice, this);

        /* Add the resource to the Map of sub resource*/
        m_genericDeviceResourcesMap.put(newGenericDevice.DEVICE_SERIAL_NUMBER, resource);
     }
    return resource;
}
</code></pre><h3>How to add Metadata to my resource ?</h3><p>You must modify the Generic device resource like this :</p>
<pre><code class="java">public ResourceMetadata getMetadata() {
    ImmutableResourceMetadata.Builder metadataBuilder = new ImmutableResourceMetadata.Builder();
    metadataBuilder.set(&quot;Serial Number&quot;, m_genericDevice.DEVICE_SERIAL_NUMBER);
    metadataBuilder.set(&quot;State Activated&quot;, m_genericDevice.STATE_ACTIVATED);
    metadataBuilder.set(&quot;State Deactivated&quot;, m_genericDevice.STATE_DEACTIVATED);
    metadataBuilder.set(&quot;State Property Name&quot;, m_genericDevice.STATE_PROPERTY_NAME);
    metadataBuilder.set(&quot;Serial Unknown&quot;, m_genericDevice.STATE_UNKNOWN);
    return metadataBuilder.build();
}
</code></pre><p>Now when you send a get command you have the metadata print in the answer.</p><h3><a name="update"></a> How to interact with the object represented by the resource ?</h3><p>With adding a <em>UPDATE</em> relation in your manager.</p><p>We proceed in two step to add the relation :</p>
<ul>
  <li>First : modify the manager constructor like this to add a relation :</li>
</ul>
<pre><code class="java">public GenericDeviceResource(GenericDevice genericDevice, GenericDeviceManager genericDeviceManager) {

    super(genericDeviceManager.m_genericDevicePath.add(Path.from(Path.SEPARATOR + genericDevice.DEVICE_SERIAL_NUMBER)));
    this.m_genericDevice = genericDevice;
    this.m_genericDeviceManager = genericDeviceManager;
    new DefaultRelation(getPath(), Action.UPDATE, &quot;Update field&quot;,
        new DefaultParameter()
            .name(&quot;parameter/value&quot;)
            .description(&quot; Modify the parameter of the device with the value&quot;)
            .optional(false)
            .type(Map.class));

}

</code></pre>
<ul>
  <li>Second : implement the method <em>update</em> witch is called by the relation <em>UPDATE</em> :</li>
</ul>
<pre><code class="java">@Override
public Resource update(Request request) throws IllegalActionOnResourceException {
    Map&lt;String, ?&gt; newMap = request.parameters();
    if (newMap != null) {
        for (String key : newMap.keySet()) {
            if (key.contentEquals(&quot;STATE_DEACTIVATED&quot;))
                m_genericDevice.setSTATE_DEACTIVATED(newMap.get(key).toString());
        }
    }
    return this;
}
</code></pre><h2>Manage your relation</h2><h3>Relation between 2 resources</h3><p>In our example, each device will be located in one zone. And, in a zone, we could have several devices. This fact will be represented by <strong>relations</strong>.</p><h4>Relation device &ndash;&gt; zone.</h4><p>Let&rsquo;s implement the relation in the DeviceResource. We imagine that a device is not fixed in the space, it can be move to an other zone. In rest the action is traduce by an <em>UPDATE</em> action on the resource. This action have already been  implemented in <a href="#update" title="How to interact with the object represented by the resource ?">How to interact with the object represented by the resource ?</a>.  We just have to add a new case when we see the key word <em>zone</em>.</p>
<pre><code class="java">else if  (key.contentEquals(&quot;zone&quot;)){
    m_genericDevice.zone =  newMap.get(key).toString();
    Relation  relations = new DefaultRelation(ZoneManager.getInstance().getPath().add(Path.from(Path.SEPARATOR + m_genericDevice.zone )), Action.READ, &quot;Location&quot;);
    setRelations(relations);
}
</code></pre><p>So now if your update,with the ReST client, a device with a <em>POST</em> request (first parameter : zone, second parameter : bathroom) and do a <em>GET</em> request on the DeviceResource, we will see the relation called &ldquo;Location&rdquo; :</p>
<pre><code class="json">__relations: {
    Location: {
         href: &quot;http://localhost:8080/everest/casa/zone/bathroom&quot;
         action: &quot;READ&quot;
         name: &quot;Location&quot;
        description: null
        parameters: [0]
    }-
}
</code></pre><p>But when we do a <em>GET</em> on <a href="chrome-extension://hgmloofddffdnphfgcellkdfbfbjeloo/RestClient.html" title="http://localhost:8080/everest/casa">http://localhost:8080/everest/casa/zone/bathroom</a> we see :</p>
<pre><code class="json">{
    Name: &quot;bathroom&quot;
    Luminosity: &quot;10&quot;
    __relations: {}-
    __observable: false
}
</code></pre><p>There is not the relation ! So let&rsquo;s do the second part in order to see how implement the relation between the bathroom and the device present in this zone.</p><h4>Relation device &lt;&ndash; zone.</h4><p>When you update the location of a device you want that a relation between the zone and the device may be implemented too. In order too we implement two method in ZoneResource :</p>
<ul>
  <li>setDeviceLocation(String serialNumber) : this method add a relation between the zone and a device identified by the serial number. It will used if a device appear in the zone.</li>
  <li>deleteDeviceLocation(String serialNumber) : this method delete a relation between the zone and a device identified by the serial number. It will used if a device is moved out of the zone.</li>
</ul>
<pre><code class="java">public void deleteDeviceLocation(String serialNumber) {
    List&lt;Relation&gt; relations ;

    /*Browse the relation list until we find the relation corresponding to the relation that we want to delete*/
    for (Relation current : getRelations()){
        if(current.getName().equalsIgnoreCase(&quot;device&quot;+serialNumber)){
            relations = getRelations();
            relations.remove(current) ;
            setRelations(relations);
        }
    }
}

public void setDeviceLocation(String serialNumber) {
    List&lt;Relation&gt; relations ;

    /* save the all relation */
    relations = getRelations();

    /* add or update the relation with the device */
    relations.add(new DefaultRelation(GenericDeviceManager.getInstance().getPath().add(Path.from(Path.SEPARATOR + serialNumber)), Action.READ, &quot;device&quot;+serialNumber)) ;
    setRelations(relations);
}
</code></pre><p>Then this operation will be manage by the ZoneManager. So we need to declare a new field in the zone manager which contain  the serialnumber of a device and the location of a device.This Map will be update each time that a device moved.</p>
<pre><code class="java">/**
* Map of Generic Device resource by serial Number
*/
private Map&lt;String, String&gt; m_genericDeviceByZone = new HashMap&lt;String, String&gt;();
</code></pre><p>To finish we need to create the method which update the relation between the zone and the device :</p>
<pre><code class="java">public void setChildLocation(String serialNumber,String Location) {

    /* if the relation relation already exist, we delete the precedent relation before create a new one */
    if(m_genericDeviceByZone.get(serialNumber) != null) {
        m_zoneResourcesMap.get(m_genericDeviceByZone.get(serialNumber)).deleteDeviceLocation(serialNumber);
    }

    /* Add the device to the list or replace the old location */
    m_genericDeviceByZone.put(serialNumber,Location);
    for (String key : m_zoneResourcesMap.keySet()){

        /* If the new location exist in the sub resource, a relation between the device and the sub resource will be create */
        if (m_zoneResourcesMap.get(key).getPath().getLast().toString().equalsIgnoreCase(Location)){
        m_zoneResourcesMap.get(key).setDeviceLocation(serialNumber);
        }
    }
}
</code></pre><p>This method will be called each time we <em>UPDATE</em> the device&rsquo;s zone :</p>
<pre><code class="java">else if  (key.contentEquals(&quot;zone&quot;)){
    m_genericDevice.zone =  newMap.get(key).toString();
    Relation  relations = new DefaultRelation(ZoneManager.getInstance().getPath().add(Path.from(Path.SEPARATOR + m_genericDevice.zone )), Action.READ, &quot;Location&quot;);
    setRelations(relations);
    ZoneManager.getInstance().setChildLocation(m_genericDevice.DEVICE_SERIAL_NUMBER,newMap.get(key).toString());
}
</code></pre><p>So now after <em>UPDATE</em> a device&rsquo;s zone, when we do a <em>GET</em> on the zone we will see :</p>
<pre><code class="json">{
    Name: &quot;bathroom&quot;
    Luminosity: &quot;10&quot;
    __relations: {
        device10: {
            href: &quot;http://localhost:8080/everest/casa/devices/10&quot;
            action: &quot;READ&quot;
            name: &quot;device10&quot;
            description: null
            parameters: [0]
        }-
    }-
    __observable: false
}
</code></pre>
                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
              <div class="row span12">Copyright &copy;                    2009-2013
                        <a href="http://ow2.org">OW2 Chameleon</a>.
            All Rights Reserved.      
                    
      </div>

        
        
                </div>
    </footer>
  </body>
</html>
